#!/bin/bash

# Firebaseè‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®åˆæœŸè¨­å®šã‚’æ”¯æ´ã—ã¾ã™

set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${GREEN}ðŸ”¥ Firebase ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n${YELLOW}ðŸ“‹ å¿…è¦ãªä½œæ¥­ï¼š${NC}"
echo -e "1. Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ"
echo -e "2. Webã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã—ã¦è¨­å®šå€¤ã‚’å–å¾—"
echo -e "3. Authenticationã€Firestoreã€Storageã‚’æœ‰åŠ¹åŒ–"
echo -e "4. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ç”Ÿæˆ"
echo -e "5. Gemini APIã‚­ãƒ¼ã‚’å–å¾—"

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ã‚¹ãƒ†ãƒƒãƒ— 1: Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n1. ä»¥ä¸‹ã®URLã‚’é–‹ã„ã¦ãã ã•ã„ï¼š"
echo -e "   ${GREEN}https://console.firebase.google.com/${NC}"
echo -e "\n2. ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯"
echo -e "3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ï¼ˆä¾‹: business-card-manager-$(date +%Y%m%d)ï¼‰"
echo -e "4. Google Analyticsã¯ä»»æ„ã§è¨­å®š"

read -p "$(echo -e ${YELLOW}ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ãŸã‚‰ Enter ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„...${NC})"

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ã‚¹ãƒ†ãƒƒãƒ— 2: Webã‚¢ãƒ—ãƒªã®è¨­å®šå€¤ã‚’å–å¾—${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n1. Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ« > ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¦‚è¦ > Webã‚¢ãƒ—ãƒªã‚’è¿½åŠ ï¼ˆ</> ã‚¢ã‚¤ã‚³ãƒ³ï¼‰"
echo -e "2. ã‚¢ãƒ—ãƒªåã‚’å…¥åŠ›ï¼ˆä¾‹: Business Card Manager Webï¼‰"
echo -e "3. ã€ŒFirebase Hostingã€ã¯ãƒã‚§ãƒƒã‚¯ä¸è¦"
echo -e "4. ã€Œã‚¢ãƒ—ãƒªã‚’ç™»éŒ²ã€ã‚’ã‚¯ãƒªãƒƒã‚¯"
echo -e "5. è¡¨ç¤ºã•ã‚ŒãŸfirebaseConfigå€¤ã‚’ã‚³ãƒ”ãƒ¼"

echo -e "\n${GREEN}è¨­å®šå€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š${NC}"

read -p "FIREBASE_API_KEY: " FIREBASE_API_KEY
read -p "FIREBASE_AUTH_DOMAIN: " FIREBASE_AUTH_DOMAIN
read -p "FIREBASE_PROJECT_ID: " FIREBASE_PROJECT_ID
read -p "FIREBASE_STORAGE_BUCKET: " FIREBASE_STORAGE_BUCKET
read -p "FIREBASE_MESSAGING_SENDER_ID: " FIREBASE_MESSAGING_SENDER_ID
read -p "FIREBASE_APP_ID: " FIREBASE_APP_ID
read -p "FIREBASE_MEASUREMENT_ID (çœç•¥å¯): " FIREBASE_MEASUREMENT_ID

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ã‚¹ãƒ†ãƒƒãƒ— 3: Firebaseæ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n${YELLOW}3-1. Authentication ã®æœ‰åŠ¹åŒ–ï¼š${NC}"
echo -e "1. Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ« > Authentication > å§‹ã‚ã‚‹"
echo -e "2. Sign-in method ã‚¿ãƒ– > ãƒ¡ãƒ¼ãƒ«/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ã‚’æœ‰åŠ¹åŒ–"
read -p "$(echo -e ${YELLOW}å®Œäº†ã—ãŸã‚‰ Enter ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„...${NC})"

echo -e "\n${YELLOW}3-2. Firestore Database ã®ä½œæˆï¼š${NC}"
echo -e "1. Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ« > Firestore Database > ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ"
echo -e "2. ã€Œæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã€ã‚’é¸æŠž"
echo -e "3. ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³: asia-northeast1 (æ±äº¬) ã¾ãŸã¯ asia-northeast2 (å¤§é˜ª) ã‚’é¸æŠž"
read -p "$(echo -e ${YELLOW}å®Œäº†ã—ãŸã‚‰ Enter ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„...${NC})"

echo -e "\n${YELLOW}3-3. Storage ã®ä½œæˆï¼š${NC}"
echo -e "1. Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ« > Storage > å§‹ã‚ã‚‹"
echo -e "2. ã€Œæœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ã€ã‚’é¸æŠž"
echo -e "3. ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³: Firestoreã¨åŒã˜ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠž"
read -p "$(echo -e ${YELLOW}å®Œäº†ã—ãŸã‚‰ Enter ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã ã•ã„...${NC})"

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ã‚¹ãƒ†ãƒƒãƒ— 4: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ç”Ÿæˆ${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n1. Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ« > ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆæ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ï¼‰"
echo -e "2. ã€Œã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã€ã‚¿ãƒ–"
echo -e "3. ã€Œæ–°ã—ã„ç§˜å¯†éµã®ç”Ÿæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯"
echo -e "4. JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™"
echo -e "\n${YELLOW}JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ä»¥ä¸‹ã®å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š${NC}"

read -p "client_email ã®å€¤: " FIREBASE_CLIENT_EMAIL
echo -e "${YELLOW}private_key ã®å€¤ã‚’å…¥åŠ›ï¼ˆæ”¹è¡Œã‚’ \\n ã«ç½®æ›ã—ãŸ1è¡Œã§ï¼‰ï¼š${NC}"
read -p "> " FIREBASE_PRIVATE_KEY

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ã‚¹ãƒ†ãƒƒãƒ— 5: Gemini API ã‚­ãƒ¼ã®å–å¾—${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n1. ä»¥ä¸‹ã®URLã‚’é–‹ã„ã¦ãã ã•ã„ï¼š"
echo -e "   ${GREEN}https://makersuite.google.com/app/apikey${NC}"
echo -e "2. ã€ŒAPIã‚­ãƒ¼ã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯"
echo -e "3. ç”Ÿæˆã•ã‚ŒãŸAPIã‚­ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼"

read -p "Gemini API Key: " GEMINI_API_KEY

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

# .env.localãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ
cat > .env.local << EOF
# ===================================
# ååˆºç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ç’°å¢ƒå¤‰æ•°è¨­å®š
# è‡ªå‹•ç”Ÿæˆæ—¥: $(date)
# ===================================

# Firebaseè¨­å®š
NEXT_PUBLIC_FIREBASE_API_KEY=$FIREBASE_API_KEY
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=$FIREBASE_AUTH_DOMAIN
NEXT_PUBLIC_FIREBASE_PROJECT_ID=$FIREBASE_PROJECT_ID
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=$FIREBASE_STORAGE_BUCKET
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=$FIREBASE_MESSAGING_SENDER_ID
NEXT_PUBLIC_FIREBASE_APP_ID=$FIREBASE_APP_ID
NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID=$FIREBASE_MEASUREMENT_ID

# Firebase Admin SDK
FIREBASE_ADMIN_PROJECT_ID=$FIREBASE_PROJECT_ID
FIREBASE_ADMIN_CLIENT_EMAIL=$FIREBASE_CLIENT_EMAIL
FIREBASE_ADMIN_PRIVATE_KEY="$FIREBASE_PRIVATE_KEY"

# Google Gemini AI API
GEMINI_API_KEY=$GEMINI_API_KEY

# n8n Webhookè¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
N8N_WEBHOOK_URL=

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
NEXT_PUBLIC_APP_ENV=production
CSRF_SECRET=$(openssl rand -hex 32)
API_SECRET_KEY=$(openssl rand -hex 64)

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
NEXT_PUBLIC_APP_URL=http://localhost:3000
NODE_ENV=production
EOF

# .firebasercãƒ•ã‚¡ã‚¤ãƒ«ã®æ›´æ–°
cat > .firebaserc << EOF
{
  "projects": {
    "default": "$FIREBASE_PROJECT_ID"
  }
}
EOF

echo -e "\n${GREEN}âœ… è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã—ãŸï¼${NC}"

echo -e "\n${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${YELLOW}Firebase ãƒ«ãƒ¼ãƒ«ã®ãƒ‡ãƒ—ãƒ­ã‚¤${NC}"
echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n${YELLOW}Firebaseã«ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™...${NC}"
echo -e "ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ã„ãŸã‚‰Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„"
firebase login

echo -e "\n${YELLOW}ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™...${NC}"
firebase deploy --only firestore:rules,storage:rules,firestore:indexes

echo -e "\n${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${GREEN}ðŸŽ‰ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ï¼${NC}"
echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"

echo -e "\n${YELLOW}æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼š${NC}"
echo -e "1. npm install    # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
echo -e "2. npm run dev    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•"
echo -e "3. npm run build  # æœ¬ç•ªãƒ“ãƒ«ãƒ‰"
echo -e "4. ./deploy.sh    # ãƒ‡ãƒ—ãƒ­ã‚¤"

echo -e "\n${GREEN}ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³URL: http://localhost:3000${NC}"